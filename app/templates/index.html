{% extends "base.html" %}

{% block content %}

    {% include 'flash.html' %}

    <div class="col-sm-8 blog-main review-listing">

        <div class="row">
            
            {% if community_reviews %}

            <div class="col-sm-12"><h2 class="page-title">Latest Community Reviews</h2></div>

            {% for community_review in community_reviews %}
            <div class="blog-post">

                <div class="col-sm-12">

                    <h3 class="blog-post-title"><a href="{{ url_for('community_review', platform_slug=community_review.game.platform.slug, game_slug=community_review.game.slug, community_review_id=community_review.id) }}">{{ community_review.game.title }} - {{ community_review.game.platform.title }}</a></h3>

                    <p class="meta">
                        {% if community_review.reddit_permalink %}
                        Created by /r/{{ community_review.subreddit }} users, starting on {{ community_review.date_posted.strftime('%b %d, %Y') }}
                        {% endif %}
                        {% if session.logged_in %}
                        | <a href="{{ url_for('admin_community_review', community_review_id=community_review.id) }}">Edit</a>
                        {% endif %}
                        </p>

                    {% if community_review.user_reviews %}

                    <p class="ratings">
                        {% set avg_rating=get_avg_rating(community_review.id) %}
                        <strong class="serif">Community Rating:</strong> &nbsp; <span class="highlight">{{ "{0:.2f}".format(avg_rating[0][0]) }}</span> out of 10 
                        <br />
                        {% set review_count=get_review_count(community_review.id) %}
                        <strong class="serif">Total Reviews:</strong> &nbsp; <span class="highlight">{{ review_count[0][0] }}</span>
                    </p>

                    {% endif %}

                    <a class="more" href="{{ url_for('community_review', platform_slug=community_review.game.platform.slug, game_slug=community_review.game.slug, community_review_id=community_review.id) }}">More</a>

                </div>

                <div class="clear"></div>

            </div>
            {% endfor %}

            {% else %}
            <div class="col-sm-12"><p><strong>Sorry, there are no Community Reviews.</strong></p></div>
            {% endif %}

        </div>

    </div>

    {% include 'sidebar.html' %}

{% endblock %}
