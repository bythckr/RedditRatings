{% extends "my_base.html" %}

{% block page_content %}
<div class="listing">

    {% if page_title %}
    <div class="page-header">
        <h2>
            {{ page_title }}
            {% if session.logged_in %}
            <small> | <a href="{{ url_for('communityreview_model_view.edit_view', id=community_review.id) }}">Edit</a></small>
            {% endif %}
        </h2>
    </div>
    {% endif %}

    <p class="meta">

        {% if community_review.reddit_permalink %}

        <a href="http://redd.it/{{ community_review.reddit_id }}" target="_blank">Created by /r/{{ community_review.subreddit }}, starting on {{ community_review.date_posted.strftime('%b %d, %Y') }}</a><br />

            {% if last_crawl %}
            <span class="last-updated">Last updated {{ last_crawl }}</span>
            {% endif %}

        {% endif %}

    </p>

    {% if user_reviews %}

    <table class="sidebar-module-inset game-ratings">

        <tr>
            <td class="rating">            
                <h3 class="rating-label">Community Rating <span id="explain-rating" class="explain">(<a href="#" class="tooltip-link" data-toggle="tooltip" title="Community Rating is the average rating of all submitted reviews.">?</a>)</span>:</h3>
                <div class="rating-value">{{ community_review.get_avg_rating() }} <span class="out-of">/ 10</span></div>

            </td>
            <td class="rating">
                <h3 class="rating-label">Total Reviews <span id="explain-total" class="explain">(<a href="#" class="tooltip-link" data-toggle="tooltip" title="Total Reviews is the total # of reviews collected, including reviews that did not have a Details section and are therefore not listed below.">?</a>)</span>:</h3>
                <div class="rating-value">{{ community_review.get_review_count() }}</div>
            </td>
        </tr>

    </table>

    <div class="reddit-credit"><a href="http://redd.it/{{ community_review.reddit_id }}" target="_blank">All user reviews sourced from /r/{{ community_review.subreddit }}</a></div>

    <div class="user-reviews">

        <h3>User Reviews (sorted by reddit score):</h3>

        {% for user_review in user_reviews %}
        <div class="user-review">

            <h4><a class="redditor" href="{{ community_review.reddit_permalink}}{{ user_review.reddit_id }}" target="_blank">{{ user_review.user.username }}</a> | {{ user_review.rating }} <span>out of 10</span></h4>

            {% if user_review.review != '' %}
            <div class="review">
                {{ user_review.review }}
            </div>
            {% endif %}

            <div class="review-details">
                <strong>Reddit Score:</strong> {{ user_review.reddit_score }}
            </div>

            {% if session.logged_in %}
            <div class="actions">
                <a href="#">Delete</a>
            </div>
            {% endif %}

        </div>
        {% endfor %}
    </div>

    {% else %}

    <p><strong><a href="http://redd.it/{{ community_review.reddit_id }}" target="_blank">Click here to contribute to this reddit review</a></strong></p>

    {% endif %}

</div>
{% endblock %}

{% block sidebar %}

{% if community_review.open_for_comments %}
<div class="sidebar-module well">

    <div class="submit-review"><a href="http://redd.it/{{ community_review.reddit_id }}" target="_blank">Submit your review on reddit</a></div>

</div>
{% endif %}

{% if community_review.official_url %}
<div class="sidebar-module review-links">

    <strong><a href="{{ community_review.official_url }}" target="_blank">Learn more about this game</a></strong>

</div>
{% endif %}

{% endblock %}
